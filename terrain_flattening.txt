Goal of Terrain Flattening
Convert radiometrically calibrated Ïƒâ° (sigma nought, referenced to flat slant-range)
â†’ into Î³â° (gamma nought, referenced to the projected ground area)

 
Where:

Ïƒâ° = calibrated backscatter (in slant-range geometry)

Î¸_lia = local incidence angle, depends on terrain

ğŸ”§ What You Need
Input	Description
âœ… Ïƒâ° Image	Calibrated SAR image (VV/VH) in slant-range
âœ… DEM (e.g., SRTM)	Elevation data to compute slope + aspect
âœ… Orbit file	Needed for radar geometry & sensor position
âœ… Antenna geometry	To compute radar line of sight

ğŸ§  Step-by-Step: Best Practice Approach
1. Compute Radar Look Vector
From orbit + metadata

Defines line-of-sight direction for each pixel

Can be constant per range line (approximate) or full per-pixel (accurate)

2. Compute DEM Surface Normal
Calculate slope & aspect from the DEM

Create 3D surface normal vector for each pixel

3. Compute Î¸_lia (Local Incidence Angle)

4. Apply Terrain Flattening


ğŸ§® Variants and Approaches
Method	Notes
ğŸ“ Cosine Division	Simple, accurate, and fast (recommended!)
ğŸ§­ Area Projection Ratio	Uses ground area per pixel to correct Ïƒâ° (complex, rarely used)
ğŸ›° LUT-based Flattening (SNAP)	SNAP uses a precomputed LUT for terrain flattening
ğŸ§® Per-pixel Î¸_lia with DEM	Most accurate; terrain-aware Gammaâ°

ğŸ† Best Practice
âœ… Use per-pixel Î¸_lia from DEM and radar geometry
âœ… Apply cosine correction after calibration
âœ… Use valid-data mask to filter:

- radar shadow
- layover
- DEM voids

ğŸ“¦ Open Tools That Implement This
Tool	How it handles terrain flattening
SNAP	Built-in Terrain Flattening operator
pyroSAR	Uses GAMMA via snap or geocode wrapper
sarsen	Has a terrain_flattening module
ISCE2	More InSAR focused, not ideal for Î³â°

ğŸ” Practical Tips
Use a high-resolution DEM (30â€¯m or better)

Be careful with edge areas â€” interpolate missing DEM data

Cache Î¸_lia if processing multiple scenes over same area

Avoid flattening on Î²â° â€” always start with Ïƒâ°

ğŸ§° Optional Enhancements
Create a layover/shadow mask (for masking invalid areas)

Export Î¸_lia as separate raster (for QA/QC)

Provide flattening in linear and dB scale

âœ… TL;DR â€“ The Best Approach
ğŸ”¹ Use:

gamma0 = sigma0 / cos(theta_lia)
where Î¸_lia is computed per-pixel from DEM + radar geometry
â†’ Thatâ€™s accurate, fast, and reproducible

